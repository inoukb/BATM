<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bikes Against The Machine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <style>
      body {
        background: url("assets/img/pattern6.png") repeat;
      }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/img/BATM32.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

  	<div class="navbar">
    	<div class="navbar-inner navbar navbar-fixed-top">
			<div class="span1"><img src="assets/img/poursuite42.png"></div>
			<div class="span11">
 				<a class="brand" href="index.html">Bike Against The Machine</a>
    			<ul class="nav">
    				<li class="active"><a href="index.html">Home</a></li>
    				<li><a href="goodies">Goodies</a></li>
    				<li><a href="about">About</a></li>
    			</ul>
				</div>		
    	</div>
    </div>

    <div class="container">

			<div class="row-fluid">
		  	<div class="span2">
      	<p>Stream of photos taken around...</p>
                            <div id="stream">
    				</div>
			</div>
		
			<div class="span10">
				
				<p>
					<form class="form-search" onsubmit="return false;">
				  	<input id="search" type="text" placeholder="Location..." class="input-large search-query">
					</form>
				</p>

				<div style="width:800px;height:600px" id="map"></div>
		
			</div>
			
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("maps", "3", {
    callback: initialize,
    other_params: "sensor=false&libraries=places"
});
var map;
function initialize() {
    // Initialize default values
    var zoom = 3;
    var latlng = new google.maps.LatLng(37.4419, - 100.1419);

    // If ClientLocation was filled in by the loader, use that info instead
    if (google.loader.ClientLocation) {
        zoom = 13;
        latlng = new google.maps.LatLng(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);
    }

    var myOptions = {
        zoom: zoom,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }

    map = new google.maps.Map(document.getElementById("map"), myOptions);

    var autocompleteInput = document.getElementById("search");
    var autocomplete = new google.maps.places.Autocomplete(autocompleteInput);
    autocomplete.bindTo('bounds', map);

    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        if (place && place.geometry && place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        }
    });

    // retrieve photos
    retrievePhotos();
}

var url = "/api/photo";

function retrievePhotos() {
$.getJSON(url, function(data) {
    displayAll(data);
});
}

function displayAll(data) {
  for(var i=0; i<data.length; i++){
    display(data[i]);
  }
}
function display(entry) {
        var image = 'data:image/jpeg;base64,' + entry["photo"];
    $('#stream').append('<p><a href="/boulet/' + entry["id"] + '"><img src="' + image + '" class="img-rounded"><br><i class="icon-tag"></i> Nancy, Fr</p>');


        var contentString = '<div id="content">'+
            '<div style="text-align: center; margin-bottom: 1em;"><img src="' + image + '" style="max-width: 100px; max-height: 100px;"></img></div>'+
            '<div>' + entry["comment"] + '</div>'+
            '<div style="text-align: right;"><a href="/boulet/' + entry["id"] + '">Voir</a></div>'+
            '</div>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });

        var myLatLng = new google.maps.LatLng(entry["lat"], entry["lng"]);
        var marker = new google.maps.Marker({
            position: myLatLng,
            map: map
        });

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map,marker);
        });
}

</script>
		
  </body>
</html>
