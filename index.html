<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bikes Against The Machine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <style>
      body {
        background: url("assets/img/pattern6.png") repeat;
      }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/img/BATM32.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

  	<div class="navbar">
    	<div class="navbar-inner navbar navbar-fixed-top">
			<div class="span1"><img src="assets/img/poursuite42.png"></div>
			<div class="span11">
 				<a class="brand" href="index.html">Bike Against The Machine</a>
    			<ul class="nav">
    				<li class="active"><a href="index.html">Home</a></li>
    				<li><a href="goodies">Goodies</a></li>
    				<li><a href="about">About</a></li>
    			</ul>
				</div>		
    	</div>
    </div>

    <div class="container">

			<div class="row-fluid">
		  	<div class="span2">
      	<p>Stream of photos taken around...</p>
                            <div id="stream">
    				</div>
			</div>
		
			<div class="span10">
				
				<p>
					<form class="form-search" onsubmit="return false;">
				  	<input id="search" type="text" placeholder="Location..." class="input-large search-query">
					</form>
				</p>

				<div style="width:800px;height:600px" id="map"></div>
				<div id="location" style="display:none;"></div>
		
			</div>
			
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("maps", "3", {
    callback: initialize,
    other_params: "sensor=false&libraries=places"
});
function initialize() {
    // Initialize default values
    var zoom = 3;
    var latlng = new google.maps.LatLng(37.4419, - 100.1419);
    var location = "Showing default location for map.";

    // If ClientLocation was filled in by the loader, use that info instead
    if (google.loader.ClientLocation) {
        zoom = 13;
        latlng = new google.maps.LatLng(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);
        location = "Showing IP-based location: <b>" + getFormattedLocation() + "</b>";
    }

    var myOptions = {
        zoom: zoom,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }

    var map = new google.maps.Map(document.getElementById("map"), myOptions);
    document.getElementById("location").innerHTML = location;

    var autocompleteInput = document.getElementById("search");
    var autocomplete = new google.maps.places.Autocomplete(autocompleteInput);
    autocomplete.bindTo('bounds', map);

    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        if (place && place.geometry && place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        }
    });

    // retrieve photos
    retrievePhotos();
}

function getFormattedLocation() {
    if (google.loader.ClientLocation.address.country_code == "US" && google.loader.ClientLocation.address.region) {
        return google.loader.ClientLocation.address.city + ", " + google.loader.ClientLocation.address.region.toUpperCase();
    } else {
        return google.loader.ClientLocation.address.city + ", " + google.loader.ClientLocation.address.country_code;
    }
}

var url = "http://against-themachine.rhcloud.com";

function retrievePhotos() {
var data = [{"longitude":6.17229,"latitude":48.6949,"radius":2192.0,"photo":"photoGet?file=1351433072743-317311556","comment":"","timestamp":1351433072000},{"longitude":6.17693,"latitude":48.694,"radius":966.0,"photo":"photoGet?file=1351429147876-773105152","comment":"","timestamp":1351396800000},{"longitude":6.17229,"latitude":48.6949,"radius":2192.0,"photo":"photoGet?file=1351429822800-639547061","comment":"Test","timestamp":1351396800000},{"longitude":6.17229,"latitude":48.6949,"radius":2192.0,"photo":"photoGet?file=1351432561058-868075302","comment":"Top","timestamp":1351432561000},{"longitude":6.17229,"latitude":48.6949,"radius":2192.0,"photo":"photoGet?file=1351433461737-15162229","comment":"Trop beau","timestamp":1351433461000},{"longitude":6.17229,"latitude":48.6949,"radius":2192.0,"photo":"photoGet?file=1351436347465-486703973","comment":"","timestamp":1351436347000}];
display(data);
//$.getJSON(url + '/photoList', function(data) {
//    console.log(data);
//});
}

function display(data) {
  for(var i=0; i<data.length; i++){
    var entry = data[i];
    $('#stream').append("<p><img src='" + url + '/' + entry["photo"] + "' class='img-rounded'><br><i class='icon-tag'></i> Nancy, Fr</p>");
  }
}

</script>
		
  </body>
</html>
